version: 3
automerge: true
autodiscover:
  mode: auto
delete_source_branch_on_merge: true
parallel_plan: true
parallel_apply: true
abort_on_execution_order_fail: true
projects:
  - name: staging
    branch: /main/
    dir: workspaces/staging
    workspace: default
    terraform_version: v1.5.7
    delete_source_branch_on_merge: true
    repo_locking: true
    custom_policy_check: false
    autoplan:
      when_modified: ["./modules/**/*.tf", "workspaces/production/.terraform.lock.hcl", "workspaces/production/*.tf"]
      enabled: true
    plan_requirements: [mergeable, approved, undiverged]
    apply_requirements: [mergeable, approved, undiverged]
    import_requirements: [mergeable, approved, undiverged]
    execution_order_group: 1
    workflow: staging_workflow
workflows:
  myworkflow:
    plan:
      steps:
        - run: echo "my custom command production"
        - init
        - plan:
            extra_args: ["-lock", "false"]
        - run: echo "my custom command afterwards - production"
    apply:
      steps:
        - run: echo "my custom apply command - production"
        - apply